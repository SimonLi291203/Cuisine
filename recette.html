<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ajouter/Modifier Recette</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Recette</h1>

<label>Titre</label>
<input type="text" id="titre">

<label>Ingrédients (séparés par des virgules)</label>
<textarea id="ingredients" rows="3"></textarea>

<label>Préparation (séparée par ligne)</label>
<textarea id="preparation" rows="5"></textarea>

<label>Notes</label>
<textarea id="notes" rows="3"></textarea>

<button onclick="saveRecette()">Sauvegarder</button>
<p><a href="index.html">← Retour à la liste</a></p>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Initialisation Firebase (remplace avec ta config)
  if (!firebase.apps.length) {
    firebase.initializeApp({
      apiKey: "AIzaSyBWp8UeYOQT2LmmLrbuix2-AFJZT47dd2E",
      authDomain: "recettes-personnelles.firebaseapp.com",
      projectId: "recettes-personnelles",
      storageBucket: "recettes-personnelles.firebasestorage.app",
      messagingSenderId: "323047086323",
      appId: "1:323047086323:web:b9afeb7a6a59a0cce03f86",
      measurementId: "G-C16RTE39L8"
    });
  }
  const db = firebase.firestore();

  // Récupérer l'ID depuis l'URL si on modifie une recette
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');

  // Si modification, remplir le formulaire
  if (id) {
    db.collection("recettes").doc(id).get().then((doc) => {
      if (doc.exists) {
        const data = doc.data();
        document.getElementById('titre').value = data.titre;
        document.getElementById('ingredients').value = data.ingredients.join(', ');
        document.getElementById('preparation').value = data.preparation.join('\n');
        document.getElementById('notes').value = data.notes;
      }
    }).catch(err => {
      alert("Erreur lors du chargement de la recette : " + err);
    });
  }

  // Fonction pour sauvegarder la recette
  function saveRecette() {
    const titre = document.getElementById('titre').value;
    const ingredients = document.getElementById('ingredients').value.split(',').map(s => s.trim());
    const preparation = document.getElementById('preparation').value.split('\n').map(s => s.trim());
    const notes = document.getElementById('notes').value;

    const data = {
      titre,
      ingredients,
      preparation,
      notes,
      date: new Date().toISOString().split('T')[0]
    };

    if (id) {
      // Modification
      db.collection("recettes").doc(id).set(data)
        .then(() => alert('Recette sauvegardée !'))
        .catch(err => alert('Erreur : ' + err));
    } else {
      // Nouvelle recette
      db.collection("recettes").add(data)
        .then(() => alert('Recette sauvegardée !'))
        .catch(err => alert('Erreur : ' + err));
    }
  }
</script>

</body>
</html>
