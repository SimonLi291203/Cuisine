<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Recette</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 id="titre-recette">Recette</h1>

<div id="recette-details">
  <p><strong>IngrÃ©dients :</strong></p>
  <ul id="ingredients-list"></ul>

  <p><strong>PrÃ©paration :</strong></p>
  <ol id="preparation-list"></ol>

  <p><strong>Notes :</strong></p>
  <p id="notes-text"></p>

  <p><strong>Date :</strong> <span id="date-text"></span></p>

  <button id="edit-btn" onclick="showEditForm()">âœï¸ Modifier</button>
  <button id="delete-btn" onclick="deleteRecette()">ğŸ—‘ï¸ Supprimer</button>
</div>

<!-- Formulaire pour modification / crÃ©ation -->
<div id="recette-form" style="display:none;">
  <label>Titre</label>
  <input type="text" id="titre">

  <label>IngrÃ©dients (sÃ©parÃ©s par des virgules)</label>
  <textarea id="ingredients" rows="3"></textarea>

  <label>PrÃ©paration (sÃ©parÃ©e par ligne)</label>
  <textarea id="preparation" rows="5"></textarea>

  <label>Notes</label>
  <textarea id="notes" rows="3"></textarea>

  <button onclick="saveRecette()">ğŸ’¾ Sauvegarder</button>
  <button onclick="cancelEdit()">âŒ Annuler</button>
</div>

<p><a href="index.html">â† Retour Ã  la liste</a></p>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Initialisation Firebase
  if (!firebase.apps.length) {
    firebase.initializeApp({
      apiKey: "AIzaSyBWp8UeYOQT2LmmLrbuix2-AFJZT47dd2E",
      authDomain: "recettes-personnelles.firebaseapp.com",
      projectId: "recettes-personnelles",
      storageBucket: "recettes-personnelles.firebasestorage.app",
      messagingSenderId: "323047086323",
      appId: "1:323047086323:web:b9afeb7a6a59a0cce03f86",
      measurementId: "G-C16RTE39L8"
    });
  }
  const db = firebase.firestore();

  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');
  // Mode crÃ©ation : pas d'ID â†’ afficher directement le formulaire
  if (!id) {
    document.getElementById('recette-details').style.display = 'none';
    document.getElementById('recette-form').style.display = 'block';
  }


  // DOM Elements
  const detailsDiv = document.getElementById('recette-details');
  const formDiv = document.getElementById('recette-form');
  const titreH1 = document.getElementById('titre-recette');
  const ingredientsList = document.getElementById('ingredients-list');
  const preparationList = document.getElementById('preparation-list');
  const notesText = document.getElementById('notes-text');
  const dateText = document.getElementById('date-text');

  const inputTitre = document.getElementById('titre');
  const inputIngredients = document.getElementById('ingredients');
  const inputPreparation = document.getElementById('preparation');
  const inputNotes = document.getElementById('notes');

  // Charger la recette
  function loadRecette() {
    if(!id) return;
    db.collection("recettes").doc(id).get()
      .then(doc => {
        if(doc.exists){
          const data = doc.data();
          titreH1.textContent = data.titre;
          ingredientsList.innerHTML = '';
          data.ingredients.forEach(i => {
            const li = document.createElement('li'); li.textContent = i; ingredientsList.appendChild(li);
          });
          preparationList.innerHTML = '';
          data.preparation.forEach(s => {
            const li = document.createElement('li'); li.textContent = s; preparationList.appendChild(li);
          });
          notesText.textContent = data.notes || '';
          dateText.textContent = data.date || '';
        } else {
          alert('Recette introuvable');
          window.location.href = 'index.html';
        }
      })
      .catch(err => alert('Erreur : '+err));
  }

  loadRecette();

  // Montrer formulaire pour modifier
  function showEditForm() {
    formDiv.style.display = 'block';
    detailsDiv.style.display = 'none';
    inputTitre.value = titreH1.textContent;
    inputIngredients.value = Array.from(ingredientsList.children).map(li=>li.textContent).join(', ');
    inputPreparation.value = Array.from(preparationList.children).map(li=>li.textContent).join('\n');
    inputNotes.value = notesText.textContent;
  }

  function cancelEdit() {
    formDiv.style.display = 'none';
    detailsDiv.style.display = 'block';
  }

  // Sauvegarder la recette
  function saveRecette() {
    const data = {
      titre: inputTitre.value,
      ingredients: inputIngredients.value.split(',').map(s=>s.trim()),
      preparation: inputPreparation.value.split('\n').map(s=>s.trim()),
      notes: inputNotes.value,
      date: new Date().toISOString().split('T')[0]
    };
    if(id){
      db.collection("recettes").doc(id).set(data)
        .then(()=> { alert('Recette sauvegardÃ©e !'); cancelEdit(); loadRecette(); })
        .catch(err => alert('Erreur : '+err));
    } else {
      db.collection("recettes").add(data)
        .then(()=> { alert('Recette sauvegardÃ©e !'); window.location.href='index.html'; })
        .catch(err => alert('Erreur : '+err));
    }
  }

  // Supprimer la recette
  function deleteRecette() {
    if(!confirm('Supprimer cette recette ?')) return;
    db.collection("recettes").doc(id).delete()
      .then(()=> { alert('Recette supprimÃ©e !'); window.location.href='index.html'; })
      .catch(err => alert('Erreur : '+err));
  }
</script>

</body>
</html>
